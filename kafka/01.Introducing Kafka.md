Learning Apache Kafka Second Edition

## 1. Apache Kafka
>挑战：①收集海量数据；②分析。  
>>分析包括：用户行为数据、应用程序的性能跟踪、以日志形式显示的动态数据、事件信息...

kafka可处理实时信息并很快地将其路由到多个消费者。提供了生产者之间信息的无缝集成，不需阻塞消费，生产者不需关心消费者是谁。
>它是一个开源的、分布式的、分区的和基于复制 日志提交的发布-订阅消息传递系统。
>>**①持久性消息传递：** 保证消息不丢失，提供O(1)常量时间性能的磁盘设计，支持大容量存储（TB）。信息持久化到硬盘，且在集群中复制，以防数据丢失；  
②**高吞吐量:** 每秒处理数百MB的读和写操作；  
③**分布式:** 以集群为中心，在kafka服务器上进行消息分区（在每个分区维护ordering semantics），并在集群上分发消费。集群可弹性、透明地增长，而不需停机；  
④**多客户端：** 支持简单集成来自不同平台的客户端（Java、NET、PHP、Ruby、Python）；  
⑤**实时:** 由生产者线程生成的消息对消费者线程立即可见（该特性对基于事件的系统非常重要，eg.复杂事件处理(CEP)系统）

提供了一种实时的发布-订阅解决方案，还支持Hadoop中的并行数据加载。

>**在生产方面，有不同类型的生产者:** eg.  
①前端web应用程序生成的日志；  
②生成web分析日志的生产者代理；  
③生成转换日志的生产者适配器；  
④生成调用跟踪日志的生产者服务。

>**在消费方面:** eg.  
①离线消费者，正在使用消息并将其存储在Hadoop或传统数据仓库，用于离线分析；  
②接近实时的消费者，正在消费信息并将其存储在NoSQL（eg.HBase或Cassandra），用于近实时分析；  
③像Spark或Storm，可在内存中过滤消息，为相关组触发警报事件。

## 2. Why do we need Kafka?
>数据通常包括用户活动、事件登录、页面访问、点击、社交网络活动，如“赞”、“分享”和“评论”、操作
和系统指标（由于高吞吐量(每秒数百万条消息)，所以通常由日志记录&传统日志聚合解决方案处理——面向离线分析eg.hadoop）
对构建实时处理系统非常局限。  

>**实时分析包括：**
①基于搜索的相关性、基于受欢迎程度、共同发生或情感分析的建议、向大众投放广告、从垃圾邮件或未经授权的数据抓取、发送高温警报的设备传感器、任何异常的用户行为或应用程序的黑客行为。
>>从生产系统收集的这些多组数据的实时使用情况，由于收集和处理的数据量大而成为一个挑战。

kafka目标是通过提供一种机制来统一线下和线上处理：
Hadoop系统中的并行负载以及在一组机器上的分区实时消耗的能力（处理流式数据很有用）。  
从架构的角度来看，它更接近于传统的消息传递系统，如ActiveMQ或RabitMQ。

## 3. Kafka use cases
>**kafka使用案例：**
>- ①日志收集：收集到文件服务器或HDFS，以消息流形式清洗抽象的日志或事件数据，并提供较低延迟处理（多数据源&分布式）；
>- ②流处理：在多个阶段对收集数据进行处理（eg.消费原始数据后，丰富或转化为新topic供进一步消费）；
>- ③日志提交：在大规模分布式系统中，复制日志，来帮故障节点恢复状态；
>- ④点击流跟踪：实时发布（eg.页面、搜索）到中心topic，可供订阅消费，包括实时处理和监控；
>- ⑤消息传递：消息brokers将数据处理和分离，kafka可取代许多流行的消息传递brokers，提供更高吞吐、内置分区、复制和容错服务。

>**公司案例：**
>- ①LinkedIn：实时活动数据和操作记录，eg.LinkedIn News Feed and LinkedIn Today、离线分析系统；
>- ②DataSift：收集监控事件和用户实时消费数据流；
>- ③Twitter：集成到storm；
>- ④Foursquare：整合监控和生产系统；
>- ⑤做为所有系统的事件总线（广播），记录、日志、定制事件等。

## 4. Installing Kafka
Kafka 0.8.x提供了许多高级特性:
>- ①0.8.x之前，若broker异常，该topic内未被消费的分区数据将丢失，现在分区提供了复制因子，可确保任何提交的消息发生丢失；
>- ②确保所有生产者、消费者有复制感知（可配置），默认生产者发送请求被阻塞至提交给所有副本（也可配置，提交消息至单一的broker）；
>- ③从轮询模式改为长轮询模式，阻塞直到从生产者提交的请求返回数据，避免了频繁拉；
>- ④附带一组管理工具：控制集群的关闭和主从选举。

局限：不能向后兼容。